!function(){angular.module("app",["ui.router","pascalprecht.translate","vcRecaptcha"]).config(["$stateProvider","$urlRouterProvider","$translateProvider",function(e,o,r){var n;switch(navigator.language.split("-")[0]){case"es":n="es_es";break;case"en":n="en_us";break;default:n="es_es"}r.useSanitizeValueStrategy("escape"),r.preferredLanguage(n),o.otherwise("/"),e.state("home",{url:"/",templateUrl:"pages/home/view.html"}).state("login",{url:"/login?:redirect",templateUrl:"pages/login/login.view.html"}).state("register",{url:"/register",templateUrl:"pages/register/register.view.html"}).state("terms",{url:"/terms",templateUrl:"pages/terms/terms.view.html"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("en_us",{HELLO:"Hello",WORLD:"world",LOADING:"loading...",LOGIN:"Login",REGISTER:"Register",USERNAME:"Username",PASSWORD:"Password",EMAIL:"Email",FORGOTTEN_PASSWORD:"Forgotten password?",LOGIN_ACTION:"Log in",REGISTER_ACTION:"Register",NEXT_ACTION:"Next",WRONG_LOGIN:"Wrong user or password. Please, try again.",WRONG_REGISTER:"Wrong register data. Check it out, and try again, please.",REGISTER_SLOGAN:"Mobile Journalism app for Breaking\n the video editing barrier on mobile",QUESTION_AGE:"How old are you?",ACCEPT_CONDITIONS_1:"I've read and I accept ",CONDITIONS:"the terms of service",ACCEPT_CONDITIONS_2:" of Vimojo",COMPLETED:"Ready!"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("es_es",{HELLO:"Hola",WORLD:"mundo",LOADING:"cargando...",LOGIN:"Acceder",REGISTER:"Registro",USERNAME:"Usuario",PASSWORD:"Contraseña",EMAIL:"Correo electrónico",FORGOTTEN_PASSWORD:"¿Has olvidado tu contraseña?",LOGIN_ACTION:"Inicia sesión",REGISTER_ACTION:"Regístrate",NEXT_ACTION:"Siguiente",WRONG_LOGIN:"Usuario o contraseña incorrectos. Inténtalo de nuevo, por favor.",WRONG_REGISTER:"Los datos de registro son incorrectos. Revísalos, e inténtalo de nuevo, por favor.",REGISTER_SLOGAN:"Mobile Journalism app for Breaking\n the video editing barrier on mobile",QUESTION_AGE:"¿Cuántos años tienes?",ACCEPT_CONDITIONS_1:"He leído, entiendo y acepto ",CONDITIONS:"las condiciones del servicio",ACCEPT_CONDITIONS_2:" de Vimojo",COMPLETED:"¡Listo!"})}])}(),function(){angular.module("app").factory("api",["$http",function(e){var o={url:"http://localhost:3000",token:"",get:function(e,o){return r("GET",e,null,o)},post:function(e,o,n){return r("POST",e,o,n)},del:function(e,o,n){return r("DELETE",e,o,n)},setToken:function(e){void 0!==e&&(o.token=e)}};return o;function r(r,t,a,i){var s={method:r,headers:{},url:t};return""!==o.token&&(s.headers.authorization="Bearer "+o.token),"POST"!==r&&"DELETE"!==r&&"PUT"!==r&&"PATCH"!==r||(s.headers["Content-Type"]="application/x-www-form-urlencoded",s.transformRequest=n,s.data=a),e(s).then(function(e){var o,r,n,t,a,s;r=i,n=(o=e).data,t=o.status,a=o.headers,s=o.config,"function"==typeof r&&r(n,t,a,s)}).catch(function(e){!function(e,o){console.log(e);var r=e.data,n=e.status,t=e.headers,a=e.config;console.error("Error "+n+" in HTTP request"),"function"==typeof o&&o(r,n,t,a)}(e,i)})}function n(e){var o=[],r=Object.keys(e),n=Object.values(e);for(let e=0;e<=r.length;e+=1)o.push(encodeURIComponent(r[e])+"="+encodeURIComponent(n[e]));return o.join("&")}}])}(),function(){angular.module("app").factory("session",["api",function(e){var o={id:-1,name:"",email:"",role:"",verified:!1,token:null,set:r,get:t,logout:a,save:n};return t(),o;function r(r){var t;o.id=r.id||-1,o.name=r.name||"",o.email=r.email||"",o.role=r.role||"",o.verified=r.verified||!1,r.token&&(t=r.token,o.token=t,e.setToken(t),n()),n()}function n(e){var r=e;void 0===r&&(delete(r=JSON.parse(JSON.stringify(o))).set,delete r.get,delete r.logout,delete r.save),localStorage.setItem("session",JSON.stringify(r))}function t(){var e=JSON.parse(localStorage.getItem("session"));null!==e?r(e):(console.warn("There was no session stored. Logout forzed."),a())}function a(){console.warn("Clossing session..."),o.id=-1,o.name="",o.email="",o.role="",o.verified=!1,localStorage.removeItem("session")}}])}(),function(){angular.module("app").controller("LoginController",["login","session","$state","$stateParams","$translate",function(e,o,r,n,t){var a=this;a.service=e,a.username="",a.password="",a.error="",a.loading=!1,a.submit=function(){""!==a.username&&""!==a.password?(a.loading=!0,a.error=null,console.log("Submiting..."),a.service.login(a.username,a.password,i)):a.error=t.instant("WRONG_LOGIN")},o.id>0&&(console.log("Found a session! Redirecting..."),r.go(n.redirect||"home"));function i(e){a.loading=!1,e?(console.log("Logged in! Redirecting..."),r.go(n.redirect||"home")):(console.log("Bad username or password..."),a.error=t.instant("WRONG_LOGIN"))}}])}(),function(){angular.module("app").factory("login",["api","session",function(e,o){var r={login:function(n,t,a){var i={email:n,password:t};return r.pending=!0,e.post(e.url+"/login",i,function(e,n){r.pending=!1;var t=!1;n>=400?(console.error("Error while logging in"),t=!1):(t=!0,o.set(e)),"function"==typeof a?a(t,e):console.warn("No callback specified for login.")})},pending:!1};return r}])}(),function(){angular.module("app").controller("RegisterController",["register","login","session","$state","$stateParams","$translate",function(e,o,r,n,t,a){var i=this;i.service=e,i.username="",i.email="",i.password="",i.age="",i.terms=!1,i.error="",i.loading=!1,i.status={register:!0,terms:!1,captcha:!1},i.submit=function(){""!==i.username&&""!==i.password?(i.loading=!0,i.error=null,console.log("Submiting..."),i.service.register(i.username,i.email,i.password,s)):i.error=a.instant("WRONG_REGISTER")},r.id>0&&(console.log("Found a session! Redirecting..."),n.go(t.redirect||"home"));function s(e){i.loading=!1,e?(i.loading=!0,console.log("Registered! Logging in..."),o.login(i.username,i.password,function(e){i.loading=!1,e?n.go(t.redirect||"home"):(i.error="Login error. Please, try again...",n.go("login"))})):(console.log("Bad username, email or password..."),i.error=a.instant("WRONG_REGISTER"))}}])}(),function(){angular.module("app").factory("register",["api",function(e){var o={register:function(r,n,t,a){var i={name:r,email:n,password:t};o.pending=!0,e.post(e.url+"/user",i,function(e,r){o.pending=!1;var n=!0;r>=400&&(console.error("Error while registering"),n=!1),a(n,e)})},pending:!1};return o}])}();