!function(){angular.module("app",["ui.router","pascalprecht.translate"]).config(["$stateProvider","$urlRouterProvider","$translateProvider",function(e,n,o){var r;switch(navigator.language.split("-")[0]){case"es":r="es_es";break;case"en":r="en_us";break;default:r="es_es"}o.useSanitizeValueStrategy("escape"),o.preferredLanguage(r),n.otherwise("/"),e.state("home",{url:"/",templateUrl:"pages/home/view.html"}).state("login",{url:"/login?:redirect",templateUrl:"pages/login/login.view.html"}).state("register",{url:"/register",templateUrl:"pages/register/register.view.html"}).state("terms",{url:"/terms",templateUrl:"pages/terms/terms.view.html"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("en_us",{HELLO:"Hello",WORLD:"world",LOADING:"loading...",LOGIN:"Login",REGISTER:"Register",USERNAME:"Username",PASSWORD:"Password",EMAIL:"Email",FORGOTTEN_PASSWORD:"Forgotten password?",LOGIN_ACTION:"Log in",REGISTER_ACTION:"Register",NEXT_ACTION:"Next",WRONG_LOGIN:"Wrong user or password. Please, try again.",WRONG_REGISTER:"Wrong register data. Check it out, and try again, please.",REGISTER_SLOGAN:"Mobile Journalism app for Breaking\n the video editing barrier on mobile",QUESTION_AGE:"How old are you?",ACCEPT_CONDITIONS_1:"I've read and I accept ",CONDITIONS:"the terms of service",ACCEPT_CONDITIONS_2:" of Vimojo",COMPLETED:"Ready!",ERROR_USERNAME_EMPTY:"The field username is empty.",ERROR_USERNAME_MIN_LENGTH:"The username is less than 5 characters long.",ERROR_USERNAME_MAX_LENGTH:"The username is longer than 30 characters long",ERROR_USERNAME_ALREADY_IN_USE:"The username is already in use. Try a new one.",ERROR_PASSWORD_EMPTY:"The field password is empty.",ERROR_PASSWORD_MIN_LENGTH:"The password is less than 5 characters long.",ERROR_PASSWORD_MAX_LENGTH:"The password is longer than 30 characters long",ERROR_EMAIL_EMPTY:"The field email is empty.",ERROR_EMAIL_MIN_LENGTH:"The email is less than 5 characters long.",ERROR_EMAIL_MAX_LENGTH:"The email is longer than 30 characters long",ERROR_EMAIL_NOT_VALID:"The email is not valid.",ERROR_EMAIL_ALREADY_IN_USE:"The email is already in use. Try a new one",ERROR_AGE_EMPTY:"The field age is empty",ERROR_AGE_WRONG:"The age must be valid",ERROR_TERMS_EMPTY:"You must accept the terms and conditions of the service"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("es_es",{HELLO:"Hola",WORLD:"mundo",LOADING:"cargando...",LOGIN:"Acceder",REGISTER:"Registro",USERNAME:"Usuario",PASSWORD:"Contraseña",EMAIL:"Correo electrónico",FORGOTTEN_PASSWORD:"¿Has olvidado tu contraseña?",LOGIN_ACTION:"Inicia sesión",REGISTER_ACTION:"Regístrate",NEXT_ACTION:"Siguiente",WRONG_LOGIN:"Usuario o contraseña incorrectos. Inténtalo de nuevo, por favor.",WRONG_REGISTER:"Los datos de registro son incorrectos. Revísalos, e inténtalo de nuevo, por favor.",REGISTER_SLOGAN:"Mobile Journalism app for Breaking\n the video editing barrier on mobile",QUESTION_AGE:"¿Cuántos años tienes?",ACCEPT_CONDITIONS_1:"He leído, entiendo y acepto ",CONDITIONS:"las condiciones del servicio",ACCEPT_CONDITIONS_2:" de Vimojo",COMPLETED:"¡Listo!",ERROR_USERNAME_EMPTY:"El nombre de usuario no puede estar vacío.",ERROR_USERNAME_MIN_LENGTH:"El nombre de usuario necesita ser mas largo.",ERROR_USERNAME_MAX_LENGTH:"El nombre de usuario necesita ser menos largo",ERROR_USERNAME_ALREADY_IN_USE:"El nombre de usuario ya está en uso. Prueba con uno nuevo.",ERROR_PASSWORD_EMPTY:"La contraseña no puede estar vacía.",ERROR_PASSWORD_MIN_LENGTH:"La contraseña necesita ser mas larga.",ERROR_PASSWORD_MAX_LENGTH:"La contraseña necesita ser menos larga.",ERROR_EMAIL_EMPTY:"El email no puede estar vacío.",ERROR_EMAIL_MIN_LENGTH:"El email necesita ser mas largo.",ERROR_EMAIL_MAX_LENGTH:"El email necesita ser menos largo.",ERROR_EMAIL_NOT_VALID:"El email no es válido.",ERROR_EMAIL_ALREADY_IN_USE:"El email ya está en uso. Prueba con uno nuevo.",ERROR_AGE_EMPTY:"La edad no puede estar vacía.",ERROR_AGE_WRONG:"La edad tiene que ser válida.",ERROR_TERMS_EMPTY:"Tienes que aceptar los términos y condiciones de uso."})}])}(),function(){angular.module("app").factory("api",["$http",function(e){var n={url:"http://localhost:3000",token:"",get:function(e,n){return o("GET",e,null,n)},post:function(e,n,r){return o("POST",e,n,r)},del:function(e,n,r){return o("DELETE",e,n,r)},setToken:function(e){void 0!==e&&(n.token=e)}};return n;function o(o,a,t,i){var s={method:o,headers:{},url:a};return""!==n.token&&(s.headers.authorization="Bearer "+n.token),"POST"!==o&&"DELETE"!==o&&"PUT"!==o&&"PATCH"!==o||(s.headers["Content-Type"]="application/x-www-form-urlencoded",s.transformRequest=r,s.data=t),e(s).then(function(e){var n,o,r,a,t,s;o=i,r=(n=e).data,a=n.status,t=n.headers,s=n.config,"function"==typeof o&&o(r,a,t,s)}).catch(function(e){!function(e,n){console.log(e);var o=e.data,r=e.status,a=e.headers,t=e.config;console.error("Error "+r+" in HTTP request"),"function"==typeof n&&n(o,r,a,t)}(e,i)})}function r(e){var n=[],o=Object.keys(e),r=Object.values(e);for(let e=0;e<=o.length;e+=1)n.push(encodeURIComponent(o[e])+"="+encodeURIComponent(r[e]));return n.join("&")}}])}(),function(){angular.module("app").factory("session",["api",function(e){var n={id:-1,name:"",email:"",role:"",verified:!1,token:null,set:o,get:a,logout:t,save:r};return a(),n;function o(o){var a;n.id=o.id||-1,n.name=o.name||"",n.email=o.email||"",n.role=o.role||"",n.verified=o.verified||!1,o.token&&(a=o.token,n.token=a,e.setToken(a),r()),r()}function r(e){var o=e;void 0===o&&(delete(o=JSON.parse(JSON.stringify(n))).set,delete o.get,delete o.logout,delete o.save),localStorage.setItem("session",JSON.stringify(o))}function a(){var e=JSON.parse(localStorage.getItem("session"));null!==e?o(e):(console.warn("There was no session stored. Logout forzed."),t())}function t(){console.warn("Clossing session..."),n.id=-1,n.name="",n.email="",n.role="",n.verified=!1,localStorage.removeItem("session")}}])}(),function(){angular.module("app").controller("LoginController",["login","session","$state","$stateParams","$translate",function(e,n,o,r,a){var t=this;t.service=e,t.username="",t.password="",t.error="",t.loading=!1,t.submit=function(){""!==t.username&&""!==t.password?(t.loading=!0,t.error=null,console.log("Submiting..."),t.service.login(t.username,t.password,i)):t.error=a.instant("WRONG_LOGIN")},n.id>0&&(console.log("Found a session! Redirecting..."),o.go(r.redirect||"home"));function i(e){t.loading=!1,e?(console.log("Logged in! Redirecting..."),o.go(r.redirect||"home")):(console.log("Bad username or password..."),t.error=a.instant("WRONG_LOGIN"))}}])}(),function(){angular.module("app").factory("login",["api","session",function(e,n){var o={login:function(r,a,t){var i={email:r,password:a};return o.pending=!0,e.post(e.url+"/login",i,function(e,r){o.pending=!1;var a=!1;r>=400?(console.error("Error while logging in"),a=!1):(a=!0,n.set(e)),"function"==typeof t?t(a,e):console.warn("No callback specified for login.")})},pending:!1};return o}])}(),function(){angular.module("app").controller("RegisterController",["register","login","session","$state","$stateParams","$translate",function(e,n,o,r,a,t){var i=this;i.service=e,i.username="",i.email="",i.password="",i.age="",i.terms=!1,i.error="",i.loading=!1,i.status={register:!0,terms:!1,captcha:!1},i.list1=function(){var e,n;i.loading=!0,i.error=null,console.log("Verifying..."),e=function(e,n){e?(i.error=n,i.loading=!1):i.service.validateUsernameAndEmail(i.username,i.email,s)},n="",""===i.username?n+="<li>"+t.instant("ERROR_USERNAME_EMPTY")+"</li>":i.username.length<5?n+="<li>"+t.instant("ERROR_USERNAME_MIN_LENGTH")+"</li>":i.username.length>30&&(n+="<li>"+t.instant("ERROR_USERNAME_MAX_LENGTH")+"</li>"),""===i.password?n+="<li>"+t.instant("ERROR_PASSWORD_EMPTY")+"</li>":i.password.length<5?n+="<li>"+t.instant("ERROR_PASSWORD_MIN_LENGTH")+"</li>":i.password.length>30&&(n+="<li>"+t.instant("ERROR_PASSWORD_MAX_LENGTH")+"</li>"),""===i.email?n+="<li>"+t.instant("ERROR_EMAIL_EMPTY")+"</li>":i.email.length<5?n+="<li>"+t.instant("ERROR_EMAIL_MIN_LENGTH")+"</li>":i.email.length>30?n+="<li>"+t.instant("ERROR_EMAIL_MAX_LENGTH")+"</li>":!1===/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/.test(i.email)&&(n+="<li>"+t.instant("ERROR_EMAIL_NOT_VALID")+"</li>"),""===n?e(!1):e(!0,n)},i.list2=function(){var e,n;i.loading=!0,i.error=null,console.log("Verifying..."),e=function(e,n){e?i.error=n:(i.status.terms=!1,i.status.captcha=!0),i.loading=!1},n="",""===i.age?n+="<li>"+t.instant("ERROR_AGE_EMPTY")+"</li>":(isNaN(parseInt(i.age,10))||parseInt(i.age,10)<=0)&&(n+="<li>"+t.instant("ERROR_AGE_WRONG")+"</li>"),!1===i.terms&&(n+="<li>"+t.instant("ERROR_TERMS_EMPTY")+"</li>"),""===n?e(!1):e(!0,n)},i.submit=function(){""!==i.username&&""!==i.password?(i.loading=!0,i.error=null,console.log("Submiting..."),i.service.register(i.username,i.email,i.password,i.age,l)):i.error=t.instant("WRONG_REGISTER")},o.id>0&&(console.log("Found a session! Redirecting..."),r.go(a.redirect||"home"));function s(e,n){e?(i.status.register=!1,i.error=null,i.status.terms=!0):i.error=n,i.loading=!1}function l(e){i.loading=!1,e?(i.loading=!0,console.log("Registered! Logging in..."),n.login(i.username,i.password,function(e){i.loading=!1,e?r.go(a.redirect||"home"):(i.error="Login error. Please, try again...",r.go("login"))})):(console.log("Bad username, email or password..."),i.error=t.instant("WRONG_REGISTER"))}}])}(),function(){angular.module("app").factory("register",["api",function(e){var n={validateUsernameAndEmail:function(n,o,r){e.get(e.url+"/user/exist?name="+n+"&email="+o,function(e,n){var o=!0;n>=400&&(console.error("Error while registering"),o=!1),console.log(e,n),r(o,e)})},register:function(o,r,a,t,i){var s={name:o,email:r,password:a,age:t};n.pending=!0,e.post(e.url+"/user",s,function(e,o){n.pending=!1;var r=!0;o>=400&&(console.error("Error while registering"),r=!1),i(r,e)})},pending:!1};return n}])}();