function videoService(e){var r={data:null,get:function(n){e.get(e.url+"/video/"+n,function(e){r.data=e})},reset:function(){r.data=null}};return r}function Gallery(e,r){this.gallery=r}function galleryService(e){return{get:function(){e.get(e.url+"/gallery",function(e,r){})}}}function VideoDownload(e,r,n){var o=this;o.id=e.id,o.code="",o.video=r,o.download=function(){n.get(o.id,o.code)},o.video.get(o.id)}function videoDownloadService(e){return{get:function(r,n){e.download(e.url+"/video/"+r+"/original?code="+n,function(e,r,n){r>=400&&console.error("Unable to download file.")})}}}!function(){angular.module("app",["app.config","ui.router","pascalprecht.translate"]).config(["$locationProvider","$stateProvider","$urlRouterProvider","$translateProvider",function(e,r,n,o){var a;switch(navigator.language.split("-")[0]){case"es":a="es_es";break;case"en":a="en_us";break;default:a="es_es"}o.useSanitizeValueStrategy("escape"),o.preferredLanguage(a),e.html5Mode({enabled:!0,requireBase:!1}),n.otherwise("/"),r.state("root",{controller:function(e){},abstract:!0}).state("home",{url:"/",templateUrl:"./pages/home/home.view.html"}).state("login",{url:"/login?:redirect",templateUrl:"pages/login/login.view.html"}).state("register",{url:"/register",templateUrl:"pages/register/register.view.html"}).state("terms",{url:"/terms",templateUrl:"pages/terms/terms.view.html"}).state("gallery",{url:"/gallery",templateUrl:"pages/gallery/gallery.view.html"}).state("videoDownload",{url:"/download/:id",parent:"root",templateUrl:"pages/video-download/video-download.view.html"})}])}(),angular.module("app.config",[]).constant("backendApiUrl","http://backend:3000"),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("en_us",{HELLO:"Hello",WORLD:"world",LOADING:"loading...",LOGIN:"Login",REGISTER:"Register",USERNAME:"Username",PASSWORD:"Password",EMAIL:"Email",FORGOTTEN_PASSWORD:"Forgotten password?",LOGIN_ACTION:"Log in",REGISTER_ACTION:"Register",NEXT_ACTION:"Next",WRONG_LOGIN:"Wrong user or password. Please, try again.",WRONG_REGISTER:"Wrong register data. Check it out, and try again, please.",REGISTER_SLOGAN:"Mobile Journalism app for Breaking\n the video editing barrier on mobile",QUESTION_AGE:"How old are you?",ACCEPT_CONDITIONS_1:"I've read and I accept ",CONDITIONS:"the terms of service",ACCEPT_CONDITIONS_2:" of Vimojo",COMPLETED:"Ready!",ERROR_USERNAME_EMPTY:"The field username is empty.",ERROR_USERNAME_MIN_LENGTH:"The username is less than 5 characters long.",ERROR_USERNAME_MAX_LENGTH:"The username is longer than 30 characters long",ERROR_USERNAME_ALREADY_IN_USE:"The username is already in use. Try a new one.",ERROR_PASSWORD_EMPTY:"The field password is empty.",ERROR_PASSWORD_MIN_LENGTH:"The password is less than 5 characters long.",ERROR_PASSWORD_MAX_LENGTH:"The password is longer than 30 characters long",ERROR_EMAIL_EMPTY:"The field email is empty.",ERROR_EMAIL_MIN_LENGTH:"The email is less than 5 characters long.",ERROR_EMAIL_MAX_LENGTH:"The email is longer than 30 characters long",ERROR_EMAIL_NOT_VALID:"The email is not valid.",ERROR_EMAIL_ALREADY_IN_USE:"The email is already in use. Try a new one",ERROR_AGE_EMPTY:"The field age is empty",ERROR_AGE_WRONG:"The age must be valid",ERROR_TERMS_EMPTY:"You must accept the terms and conditions of the service",ERROR_RECAPTCHA_NOT_CHECKED:"This app only is able to be used by humans. Aren't you human?"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("es_es",{HELLO:"Hola",WORLD:"mundo",LOADING:"cargando...",LOGIN:"Acceder",REGISTER:"Registro",USERNAME:"Usuario",PASSWORD:"Contraseña",EMAIL:"Correo electrónico",FORGOTTEN_PASSWORD:"¿Has olvidado tu contraseña?",LOGIN_ACTION:"Inicia sesión",REGISTER_ACTION:"Regístrate",NEXT_ACTION:"Siguiente",WRONG_LOGIN:"Usuario o contraseña incorrectos. Inténtalo de nuevo, por favor.",WRONG_REGISTER:"Los datos de registro son incorrectos. Revísalos, e inténtalo de nuevo, por favor.",REGISTER_SLOGAN:"Aplicación de periodismo móvil\nRompiendo la barrera de edición en móvil.",QUESTION_AGE:"¿Cuántos años tienes?",ACCEPT_CONDITIONS_1:"He leído, entiendo y acepto ",CONDITIONS:"las condiciones del servicio",ACCEPT_CONDITIONS_2:" de Vimojo",COMPLETED:"¡Listo!",ERROR_USERNAME_EMPTY:"El nombre de usuario no puede estar vacío.",ERROR_USERNAME_MIN_LENGTH:"El nombre de usuario necesita ser mas largo.",ERROR_USERNAME_MAX_LENGTH:"El nombre de usuario necesita ser menos largo",ERROR_USERNAME_ALREADY_IN_USE:"El nombre de usuario ya está en uso. Prueba con uno nuevo.",ERROR_PASSWORD_EMPTY:"La contraseña no puede estar vacía.",ERROR_PASSWORD_MIN_LENGTH:"La contraseña necesita ser mas larga.",ERROR_PASSWORD_MAX_LENGTH:"La contraseña necesita ser menos larga.",ERROR_EMAIL_EMPTY:"El email no puede estar vacío.",ERROR_EMAIL_MIN_LENGTH:"El email necesita ser mas largo.",ERROR_EMAIL_MAX_LENGTH:"El email necesita ser menos largo.",ERROR_EMAIL_NOT_VALID:"El email no es válido.",ERROR_EMAIL_ALREADY_IN_USE:"El email ya está en uso. Prueba con uno nuevo.",ERROR_AGE_EMPTY:"La edad no puede estar vacía.",ERROR_AGE_WRONG:"La edad tiene que ser válida.",ERROR_TERMS_EMPTY:"Tienes que aceptar los términos y condiciones de uso.",ERROR_RECAPTCHA_NOT_CHECKED:"En esta aplicación solo aceptamos humanos ¿Acaso eres un robot?"})}])}(),function(){angular.module("app").factory("api",["$http","backendApiUrl",function(e,r){var n={url:r,token:"",download:function(r,o){var a={method:"GET",headers:{},url:r,responseType:"arraybuffer"};""!==n.token&&(a.headers.authorization="Bearer "+n.token);return e(a).then(function(e){var r=e.data,n=e.headers(),a=n["x-filename"],i=n["content-type"],s=document.createElement("a");try{var l=new Blob([r],{type:i}),u=window.URL.createObjectURL(l);s.setAttribute("href",u),s.setAttribute("download",a);var d=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});s.dispatchEvent(d)}catch(e){console.log(e)}t(e,o)}).catch(function(e){i(e,o)})},get:function(e,r){return o("GET",e,null,r)},post:function(e,r,n){return o("POST",e,r,n)},del:function(e,r,n){return o("DELETE",e,r,n)},setToken:function(e){void 0!==e&&(n.token=e)}};return n;function o(r,o,s,l){var u={method:r,headers:{},url:o};return""!==n.token&&(u.headers.authorization="Bearer "+n.token),"POST"!==r&&"DELETE"!==r&&"PUT"!==r&&"PATCH"!==r||(u.headers["Content-Type"]="application/x-www-form-urlencoded",u.transformRequest=a,u.data=s),e(u).then(function(e){t(e,l)}).catch(function(e){i(e,l)})}function a(e){var r=[],n=Object.keys(e),o=Object.values(e);for(let e=0;e<=n.length;e+=1)r.push(encodeURIComponent(n[e])+"="+encodeURIComponent(o[e]));return r.join("&")}function t(e,r){var n=e.data,o=e.status,a=e.headers,t=e.config;"function"==typeof r&&r(n,o,a,t)}function i(e,r){console.log(e);var n=e.data,o=e.status,a=e.headers,t=e.config;console.error("Error "+o+" in HTTP request"),"function"==typeof r&&r(n,o,a,t)}}])}(),function(){angular.module("app").factory("session",["api",function(e){var r={id:-1,name:"",email:"",role:"",verified:!1,token:null,set:n,get:a,logout:t,save:o};return a(),r;function n(n){var a;r.id=n._id||n.id||-1,r.name=n.name||"",r.email=n.email||"",r.role=n.role||"",r.verified=n.verified||!1,n.token&&(a=n.token,r.token=a,e.setToken(a),o()),o()}function o(e){var n=e;void 0===n&&(delete(n=JSON.parse(JSON.stringify(r))).set,delete n.get,delete n.logout,delete n.save),localStorage.setItem("session",JSON.stringify(n))}function a(){var e=JSON.parse(localStorage.getItem("session"));null!==e?n(e):(console.warn("There was no session stored. Logout forzed."),t())}function t(){console.warn("Clossing session..."),r.id=-1,r.name="",r.email="",r.role="",r.verified=!1,localStorage.removeItem("session")}}])}(),angular.module("app").service("video",["api",videoService]),angular.module("app").controller("GalleryController",["$stateParams","gallery",Gallery]),angular.module("app").service("Gallery",["api",galleryService]),function(){angular.module("app").controller("LoginController",["login","session","$state","$stateParams","$translate",function(e,r,n,o,a){var t=this;t.service=e,t.username="",t.password="",t.error="",t.loading=!1,t.submit=function(){""!==t.username&&""!==t.password?(t.loading=!0,t.error=null,console.log("Submiting..."),t.service.login(t.username,t.password,i)):t.error=a.instant("WRONG_LOGIN")},r.id>0&&(console.log("Found a session! Redirecting..."),n.go(o.redirect||"home"));function i(e){t.loading=!1,e?(console.log("Logged in! Redirecting..."),n.go(o.redirect||"home")):(console.log("Bad username or password..."),t.error=a.instant("WRONG_LOGIN"))}}])}(),function(){angular.module("app").factory("login",["api","session",function(e,r){var n={login:function(o,a,t){var i={email:o,password:a};return n.pending=!0,e.post(e.url+"/login",i,function(e,o){n.pending=!1;var a=!1;o>=400?(console.error("Error while logging in"),a=!1):(a=!0,r.set(e)),"function"==typeof t?t(a,e):console.warn("No callback specified for login.")})},pending:!1};return n}])}(),function(){angular.module("app").controller("RegisterController",["register","login","session","$state","$stateParams","$translate",function(e,r,n,o,a,t){var i=this;i.service=e,i.username="",i.email="",i.password="",i.age="",i.terms=!1,i.error=[],i.loading=!1,i.activeView={credentials:!0,terms:!1},i.validateRegister=function(){var e;i.loading=!0,i.error=null,e=function(e){e?i.loading=!1:i.service.validateUsernameAndEmail(i.username,i.email,s)},i.error=[],""===i.username?i.error.push(t.instant("ERROR_USERNAME_EMPTY")):i.username.length<5?i.error.push(t.instant("ERROR_USERNAME_MIN_LENGTH")):i.username.length>30&&i.error.push(t.instant("ERROR_USERNAME_MAX_LENGTH")),""===i.password?i.error.push(t.instant("ERROR_PASSWORD_EMPTY")):i.password.length<5?i.error.push(t.instant("ERROR_PASSWORD_MIN_LENGTH")):i.password.length>30&&i.error.push(t.instant("ERROR_PASSWORD_MAX_LENGTH")),""===i.email?i.error.push(t.instant("ERROR_EMAIL_EMPTY")):i.email.length<5?i.error.push(t.instant("ERROR_EMAIL_MIN_LENGTH")):i.email.length>30?i.error.push(t.instant("ERROR_EMAIL_MAX_LENGTH")):/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/.test(i.email)||i.error.push(t.instant("ERROR_EMAIL_NOT_VALID")),0===i.error.length?e(!1):e(!0)},i.submit=function(){i.error=[],function(e){i.error=[];var r=window.grecaptcha.getResponse();i.terms||i.error.push(t.instant("ERROR_TERMS_EMPTY")),r||i.error.push(t.instant("ERROR_CAPTCHA")),0===i.error.length?e(!0):e(!1)}(function(e){e&&(""!==i.username&&""!==i.password?(i.loading=!0,i.service.register(i.username,i.email,i.password,i.age,l)):i.error.push(t.instant("WRONG_REGISTER")))})},n.id>0&&o.go(a.redirect||"home");function s(e){i.loading=!1,e?(i.activeView.credentials=!1,i.activeView.terms=!0,window.grecaptcha.render(document.getElementById("recaptcha"))):i.error.push(t.instant("ERROR_EMAIL_ALREADY_IN_USE"))}function l(e){i.loading=!1,e?(i.loading=!0,r.login(i.email,i.password,function(e){i.loading=!1,e?o.go(a.redirect||"home"):(i.error.push(t.instant("WRONG_LOGIN")),o.go("login"))})):i.error.push(t.instant("WRONG_REGISTER"))}}])}(),function(){angular.module("app").factory("register",["api",function(e){var r={validateUsernameAndEmail:function(r,n,o){e.get(e.url+"/user/exist?name="+r+"&email="+n,function(e,r){var n=!0;r>=400&&(console.error("Error while registering"),n=!1),console.log(e,r),o(n,e)})},register:function(n,o,a,t,i){var s={name:n,email:o,password:a,age:t};r.pending=!0,e.post(e.url+"/user",s,function(e,n){r.pending=!1;var o=!0;n>=400&&(console.error("Error while registering"),o=!1),i(o,e)})},pending:!1};return r}])}(),angular.module("app").controller("VideoDownloadController",["$stateParams","video","videoDownload",VideoDownload]),angular.module("app").service("videoDownload",["api",videoDownloadService]);