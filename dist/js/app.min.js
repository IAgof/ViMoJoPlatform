function videoService(e){var r={data:null,get:function(o){e.get(e.url+"/video/"+o,function(e){r.data=e})},reset:function(){r.data=null}};return r}function Gallery(e,r){this.gallery=r}function galleryService(e){return{get:function(){e.get(e.url+"/gallery",function(e,r){})}}}function VideoDownload(e,r,o){var n=this;n.id=e.id,n.code="",n.video=r,n.download=function(){o.get(n.id,n.code)},n.video.get(n.id)}function videoDownloadService(e){return{get:function(r,o){e.download(e.url+"/video/"+r+"/original?code="+o,function(e,r,o){r>=400&&console.error("Unable to download file.")})}}}!function(){angular.module("app",["ui.router","pascalprecht.translate"]).config(["$locationProvider","$stateProvider","$urlRouterProvider","$translateProvider",function(e,r,o,n){var a;switch(navigator.language.split("-")[0]){case"es":a="es_es";break;case"en":a="en_us";break;default:a="es_es"}n.useSanitizeValueStrategy("escape"),n.preferredLanguage(a),e.html5Mode({enabled:!0,requireBase:!1}),o.otherwise("/"),r.state("root",{controller:function(e){},abstract:!0}).state("home",{url:"/",templateUrl:"./pages/home/home.view.html"}).state("login",{url:"/login?:redirect",templateUrl:"pages/login/login.view.html"}).state("register",{url:"/register",templateUrl:"pages/register/register.view.html"}).state("terms",{url:"/terms",templateUrl:"pages/terms/terms.view.html"}).state("gallery",{url:"/gallery",templateUrl:"pages/gallery/gallery.view.html"}).state("videoDownload",{url:"/download/:id",parent:"root",templateUrl:"pages/video-download/video-download.view.html"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("en_us",{HELLO:"Hello",WORLD:"world",LOADING:"loading...",LOGIN:"Login",REGISTER:"Register",USERNAME:"Username",PASSWORD:"Password",EMAIL:"Email",FORGOTTEN_PASSWORD:"Forgotten password?",LOGIN_ACTION:"Log in",REGISTER_ACTION:"Register",NEXT_ACTION:"Next",WRONG_LOGIN:"Wrong user or password. Please, try again.",WRONG_REGISTER:"Wrong register data. Check it out, and try again, please.",REGISTER_SLOGAN:"Mobile Journalism app for Breaking\n the video editing barrier on mobile",QUESTION_AGE:"How old are you?",ACCEPT_CONDITIONS_1:"I've read and I accept ",CONDITIONS:"the terms of service",ACCEPT_CONDITIONS_2:" of Vimojo",COMPLETED:"Ready!",ERROR_USERNAME_EMPTY:"The field username is empty.",ERROR_USERNAME_MIN_LENGTH:"The username is less than 5 characters long.",ERROR_USERNAME_MAX_LENGTH:"The username is longer than 30 characters long",ERROR_USERNAME_ALREADY_IN_USE:"The username is already in use. Try a new one.",ERROR_PASSWORD_EMPTY:"The field password is empty.",ERROR_PASSWORD_MIN_LENGTH:"The password is less than 5 characters long.",ERROR_PASSWORD_MAX_LENGTH:"The password is longer than 30 characters long",ERROR_EMAIL_EMPTY:"The field email is empty.",ERROR_EMAIL_MIN_LENGTH:"The email is less than 5 characters long.",ERROR_EMAIL_MAX_LENGTH:"The email is longer than 30 characters long",ERROR_EMAIL_NOT_VALID:"The email is not valid.",ERROR_EMAIL_ALREADY_IN_USE:"The email is already in use. Try a new one",ERROR_AGE_EMPTY:"The field age is empty",ERROR_AGE_WRONG:"The age must be valid",ERROR_TERMS_EMPTY:"You must accept the terms and conditions of the service"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("es_es",{HELLO:"Hola",WORLD:"mundo",LOADING:"cargando...",LOGIN:"Acceder",REGISTER:"Registro",USERNAME:"Usuario",PASSWORD:"Contraseña",EMAIL:"Correo electrónico",FORGOTTEN_PASSWORD:"¿Has olvidado tu contraseña?",LOGIN_ACTION:"Inicia sesión",REGISTER_ACTION:"Regístrate",NEXT_ACTION:"Siguiente",WRONG_LOGIN:"Usuario o contraseña incorrectos. Inténtalo de nuevo, por favor.",WRONG_REGISTER:"Los datos de registro son incorrectos. Revísalos, e inténtalo de nuevo, por favor.",REGISTER_SLOGAN:"Aplicación de periodismo móvil\nRompiendo la barrera de edición en móvil.",QUESTION_AGE:"¿Cuántos años tienes?",ACCEPT_CONDITIONS_1:"He leído, entiendo y acepto ",CONDITIONS:"las condiciones del servicio",ACCEPT_CONDITIONS_2:" de Vimojo",COMPLETED:"¡Listo!",ERROR_USERNAME_EMPTY:"El nombre de usuario no puede estar vacío.",ERROR_USERNAME_MIN_LENGTH:"El nombre de usuario necesita ser mas largo.",ERROR_USERNAME_MAX_LENGTH:"El nombre de usuario necesita ser menos largo",ERROR_USERNAME_ALREADY_IN_USE:"El nombre de usuario ya está en uso. Prueba con uno nuevo.",ERROR_PASSWORD_EMPTY:"La contraseña no puede estar vacía.",ERROR_PASSWORD_MIN_LENGTH:"La contraseña necesita ser mas larga.",ERROR_PASSWORD_MAX_LENGTH:"La contraseña necesita ser menos larga.",ERROR_EMAIL_EMPTY:"El email no puede estar vacío.",ERROR_EMAIL_MIN_LENGTH:"El email necesita ser mas largo.",ERROR_EMAIL_MAX_LENGTH:"El email necesita ser menos largo.",ERROR_EMAIL_NOT_VALID:"El email no es válido.",ERROR_EMAIL_ALREADY_IN_USE:"El email ya está en uso. Prueba con uno nuevo.",ERROR_AGE_EMPTY:"La edad no puede estar vacía.",ERROR_AGE_WRONG:"La edad tiene que ser válida.",ERROR_TERMS_EMPTY:"Tienes que aceptar los términos y condiciones de uso."})}])}(),function(){angular.module("app").factory("api",["$http",function(e){var r={url:"http://localhost:3000",token:"",download:function(o,n){var i={method:"GET",headers:{},url:o,responseType:"arraybuffer"};""!==r.token&&(i.headers.authorization="Bearer "+r.token);return e(i).then(function(e){var r=e.data,o=e.headers(),t=o["x-filename"],i=o["content-type"],s=document.createElement("a");try{var l=new Blob([r],{type:i}),u=window.URL.createObjectURL(l);s.setAttribute("href",u),s.setAttribute("download",t);var d=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});s.dispatchEvent(d)}catch(e){console.log(e)}a(e,n)}).catch(function(e){t(e,n)})},get:function(e,r){return o("GET",e,null,r)},post:function(e,r,n){return o("POST",e,r,n)},del:function(e,r,n){return o("DELETE",e,r,n)},setToken:function(e){void 0!==e&&(r.token=e)}};return r;function o(o,i,s,l){var u={method:o,headers:{},url:i};return""!==r.token&&(u.headers.authorization="Bearer "+r.token),"POST"!==o&&"DELETE"!==o&&"PUT"!==o&&"PATCH"!==o||(u.headers["Content-Type"]="application/x-www-form-urlencoded",u.transformRequest=n,u.data=s),e(u).then(function(e){a(e,l)}).catch(function(e){t(e,l)})}function n(e){var r=[],o=Object.keys(e),n=Object.values(e);for(let e=0;e<=o.length;e+=1)r.push(encodeURIComponent(o[e])+"="+encodeURIComponent(n[e]));return r.join("&")}function a(e,r){var o=e.data,n=e.status,a=e.headers,t=e.config;"function"==typeof r&&r(o,n,a,t)}function t(e,r){console.log(e);var o=e.data,n=e.status,a=e.headers,t=e.config;console.error("Error "+n+" in HTTP request"),"function"==typeof r&&r(o,n,a,t)}}])}(),function(){angular.module("app").factory("session",["api",function(e){var r={id:-1,name:"",email:"",role:"",verified:!1,token:null,set:o,get:a,logout:t,save:n};return a(),r;function o(o){var a;r.id=o.id||-1,r.name=o.name||"",r.email=o.email||"",r.role=o.role||"",r.verified=o.verified||!1,o.token&&(a=o.token,r.token=a,e.setToken(a),n()),n()}function n(e){var o=e;void 0===o&&(delete(o=JSON.parse(JSON.stringify(r))).set,delete o.get,delete o.logout,delete o.save),localStorage.setItem("session",JSON.stringify(o))}function a(){var e=JSON.parse(localStorage.getItem("session"));null!==e?o(e):(console.warn("There was no session stored. Logout forzed."),t())}function t(){console.warn("Clossing session..."),r.id=-1,r.name="",r.email="",r.role="",r.verified=!1,localStorage.removeItem("session")}}])}(),angular.module("app").service("video",["api",videoService]),angular.module("app").controller("GalleryController",["$stateParams","gallery",Gallery]),angular.module("app").service("Gallery",["api",galleryService]),function(){angular.module("app").controller("LoginController",["login","session","$state","$stateParams","$translate",function(e,r,o,n,a){var t=this;t.service=e,t.username="",t.password="",t.error="",t.loading=!1,t.submit=function(){""!==t.username&&""!==t.password?(t.loading=!0,t.error=null,console.log("Submiting..."),t.service.login(t.username,t.password,i)):t.error=a.instant("WRONG_LOGIN")},r.id>0&&(console.log("Found a session! Redirecting..."),o.go(n.redirect||"home"));function i(e){t.loading=!1,e?(console.log("Logged in! Redirecting..."),o.go(n.redirect||"home")):(console.log("Bad username or password..."),t.error=a.instant("WRONG_LOGIN"))}}])}(),function(){angular.module("app").factory("login",["api","session",function(e,r){var o={login:function(n,a,t){var i={email:n,password:a};return o.pending=!0,e.post(e.url+"/login",i,function(e,n){o.pending=!1;var a=!1;n>=400?(console.error("Error while logging in"),a=!1):(a=!0,r.set(e)),"function"==typeof t?t(a,e):console.warn("No callback specified for login.")})},pending:!1};return o}])}(),function(){angular.module("app").controller("RegisterController",["register","login","session","$state","$stateParams","$translate",function(e,r,o,n,a,t){var i=this;i.service=e,i.username="",i.email="",i.password="",i.age="",i.terms=!1,i.error=[],i.loading=!1,i.status={register:!0,terms:!1,captcha:!1},i.list1=function(){var e;i.loading=!0,i.error=null,e=function(e){e?i.loading=!1:i.service.validateUsernameAndEmail(i.username,i.email,s)},i.error=[],""===i.username?i.error.push(t.instant("ERROR_USERNAME_EMPTY")):i.username.length<5?i.error.push(t.instant("ERROR_USERNAME_MIN_LENGTH")):i.username.length>30&&i.error.push(t.instant("ERROR_USERNAME_MAX_LENGTH")),""===i.password?i.error.push(t.instant("ERROR_PASSWORD_EMPTY")):i.password.length<5?i.error.push(t.instant("ERROR_PASSWORD_MIN_LENGTH")):i.password.length>30&&i.error.push(t.instant("ERROR_PASSWORD_MAX_LENGTH")),""===i.email?i.error.push(t.instant("ERROR_EMAIL_EMPTY")):i.email.length<5?i.error.push(t.instant("ERROR_EMAIL_MIN_LENGTH")):i.email.length>30?i.error.push(t.instant("ERROR_EMAIL_MAX_LENGTH")):/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/.test(i.email)||i.error.push(t.instant("ERROR_EMAIL_NOT_VALID")),0===i.error.length?e(!1):e(!0)},i.list2=function(){var e;i.loading=!0,e=function(e){i.loading=!1,e||(i.status.terms=!1,i.status.captcha=!0)},i.error=[],""===i.age?i.error.push(t.instant("ERROR_AGE_EMPTY")):(isNaN(parseInt(i.age,10))||parseInt(i.age,10)<=0)&&i.error.push(t.instant("ERROR_AGE_WRONG")),!1===i.terms&&i.error.push(t.instant("ERROR_TERMS_EMPTY")),0===i.error.length?e(!1):e(!0)},i.submit=function(){i.error=[],""!==i.username&&""!==i.password?(i.loading=!0,i.service.register(i.username,i.email,i.password,i.age,l)):i.error.push(t.instant("WRONG_REGISTER"))},o.id>0&&n.go(a.redirect||"home");function s(e){i.loading=!1,e&&(i.status.register=!1,i.status.terms=!0)}function l(e){i.loading=!1,e?(i.loading=!0,r.login(i.username,i.password,function(e){i.loading=!1,e?n.go(a.redirect||"home"):(i.error.push(t.instant("WRONG_LOGIN")),n.go("login"))})):i.error.push(t.instant("WRONG_REGISTER"))}}])}(),function(){angular.module("app").factory("register",["api",function(e){var r={validateUsernameAndEmail:function(r,o,n){e.get(e.url+"/user/exist?name="+r+"&email="+o,function(e,r){var o=!0;r>=400&&(console.error("Error while registering"),o=!1),console.log(e,r),n(o,e)})},register:function(o,n,a,t,i){var s={name:o,email:n,password:a,age:t};r.pending=!0,e.post(e.url+"/user",s,function(e,o){r.pending=!1;var n=!0;o>=400&&(console.error("Error while registering"),n=!1),i(n,e)})},pending:!1};return r}])}(),angular.module("app").controller("VideoDownloadController",["$stateParams","video","videoDownload",VideoDownload]),angular.module("app").service("videoDownload",["api",videoDownloadService]);