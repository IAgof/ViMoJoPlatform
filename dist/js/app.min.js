function videoService(e){var o={data:null,get:function(n){e.get(e.url+"/video/"+n,function(e){o.data=e})},reset:function(){o.data=null}};return o}function VideoDownload(e,o,n){var r=this;r.id=e.id,r.code="",r.video=o,r.download=function(e){n.get(r.id,r.code)},r.video.get(r.id)}function videoDownloadService(e){return{get:function(e,o){}}}!function(){angular.module("app",["ui.router","pascalprecht.translate"]).config(["$locationProvider","$stateProvider","$urlRouterProvider","$translateProvider",function(e,o,n,r){var a;switch(navigator.language.split("-")[0]){case"es":a="es_es";break;case"en":a="en_us";break;default:a="es_es"}r.useSanitizeValueStrategy("escape"),r.preferredLanguage(a),n.otherwise("/"),o.state("root",{controller:function(e){},abstract:!0}).state("home",{url:"/",templateUrl:"./pages/home/home.view.html"}).state("login",{url:"/login?:redirect",templateUrl:"pages/login/login.view.html"}).state("register",{url:"/register",templateUrl:"pages/register/register.view.html"}).state("terms",{url:"/terms",templateUrl:"pages/terms/terms.view.html"}).state("videoDownload",{url:"/download/:id",parent:"root",templateUrl:"pages/video-download/video-download.view.html"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("en_us",{HELLO:"Hello",WORLD:"world",LOADING:"loading...",LOGIN:"Login",REGISTER:"Register",USERNAME:"Username",PASSWORD:"Password",EMAIL:"Email",FORGOTTEN_PASSWORD:"Forgotten password?",LOGIN_ACTION:"Log in",REGISTER_ACTION:"Register",NEXT_ACTION:"Next",WRONG_LOGIN:"Wrong user or password. Please, try again.",WRONG_REGISTER:"Wrong register data. Check it out, and try again, please.",REGISTER_SLOGAN:"Mobile Journalism app for Breaking\n the video editing barrier on mobile",QUESTION_AGE:"How old are you?",ACCEPT_CONDITIONS_1:"I've read and I accept ",CONDITIONS:"the terms of service",ACCEPT_CONDITIONS_2:" of Vimojo",COMPLETED:"Ready!",ERROR_USERNAME_EMPTY:"The field username is empty.",ERROR_USERNAME_MIN_LENGTH:"The username is less than 5 characters long.",ERROR_USERNAME_MAX_LENGTH:"The username is longer than 30 characters long",ERROR_USERNAME_ALREADY_IN_USE:"The username is already in use. Try a new one.",ERROR_PASSWORD_EMPTY:"The field password is empty.",ERROR_PASSWORD_MIN_LENGTH:"The password is less than 5 characters long.",ERROR_PASSWORD_MAX_LENGTH:"The password is longer than 30 characters long",ERROR_EMAIL_EMPTY:"The field email is empty.",ERROR_EMAIL_MIN_LENGTH:"The email is less than 5 characters long.",ERROR_EMAIL_MAX_LENGTH:"The email is longer than 30 characters long",ERROR_EMAIL_NOT_VALID:"The email is not valid.",ERROR_EMAIL_ALREADY_IN_USE:"The email is already in use. Try a new one",ERROR_AGE_EMPTY:"The field age is empty",ERROR_AGE_WRONG:"The age must be valid",ERROR_TERMS_EMPTY:"You must accept the terms and conditions of the service"})}])}(),function(){angular.module("app").config(["$translateProvider",function(e){e.translations("es_es",{HELLO:"Hola",WORLD:"mundo",LOADING:"cargando...",LOGIN:"Acceder",REGISTER:"Registro",USERNAME:"Usuario",PASSWORD:"Contraseña",EMAIL:"Correo electrónico",FORGOTTEN_PASSWORD:"¿Has olvidado tu contraseña?",LOGIN_ACTION:"Inicia sesión",REGISTER_ACTION:"Regístrate",NEXT_ACTION:"Siguiente",WRONG_LOGIN:"Usuario o contraseña incorrectos. Inténtalo de nuevo, por favor.",WRONG_REGISTER:"Los datos de registro son incorrectos. Revísalos, e inténtalo de nuevo, por favor.",REGISTER_SLOGAN:"Aplicación de periodismo móvil\nRompiendo la barrera de edición en móvil.",QUESTION_AGE:"¿Cuántos años tienes?",ACCEPT_CONDITIONS_1:"He leído, entiendo y acepto ",CONDITIONS:"las condiciones del servicio",ACCEPT_CONDITIONS_2:" de Vimojo",COMPLETED:"¡Listo!",ERROR_USERNAME_EMPTY:"El nombre de usuario no puede estar vacío.",ERROR_USERNAME_MIN_LENGTH:"El nombre de usuario necesita ser mas largo.",ERROR_USERNAME_MAX_LENGTH:"El nombre de usuario necesita ser menos largo",ERROR_USERNAME_ALREADY_IN_USE:"El nombre de usuario ya está en uso. Prueba con uno nuevo.",ERROR_PASSWORD_EMPTY:"La contraseña no puede estar vacía.",ERROR_PASSWORD_MIN_LENGTH:"La contraseña necesita ser mas larga.",ERROR_PASSWORD_MAX_LENGTH:"La contraseña necesita ser menos larga.",ERROR_EMAIL_EMPTY:"El email no puede estar vacío.",ERROR_EMAIL_MIN_LENGTH:"El email necesita ser mas largo.",ERROR_EMAIL_MAX_LENGTH:"El email necesita ser menos largo.",ERROR_EMAIL_NOT_VALID:"El email no es válido.",ERROR_EMAIL_ALREADY_IN_USE:"El email ya está en uso. Prueba con uno nuevo.",ERROR_AGE_EMPTY:"La edad no puede estar vacía.",ERROR_AGE_WRONG:"La edad tiene que ser válida.",ERROR_TERMS_EMPTY:"Tienes que aceptar los términos y condiciones de uso."})}])}(),function(){angular.module("app").factory("api",["$http",function(e){var o={url:"http://localhost:3000",token:"",download:function(n,r){var s={method:"GET",headers:{},url:n,responseType:"arraybuffer"};""!==o.token&&(s.headers.authorization="Bearer "+o.token);return e(s).then(function(e){var o=e.data,n=e.headers(),t=n["x-filename"],s=n["content-type"],i=document.createElement("a");try{var l=new Blob([o],{type:s}),u=window.URL.createObjectURL(l);i.setAttribute("href",u),i.setAttribute("download",t);var d=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});i.dispatchEvent(d)}catch(e){console.log(e)}a(e,r)}).catch(function(e){t(e,r)})},get:function(e,o){return n("GET",e,null,o)},post:function(e,o,r){return n("POST",e,o,r)},del:function(e,o,r){return n("DELETE",e,o,r)},setToken:function(e){void 0!==e&&(o.token=e)}};return o;function n(n,s,i,l){var u={method:n,headers:{},url:s};return""!==o.token&&(u.headers.authorization="Bearer "+o.token),"POST"!==n&&"DELETE"!==n&&"PUT"!==n&&"PATCH"!==n||(u.headers["Content-Type"]="application/x-www-form-urlencoded",u.transformRequest=r,u.data=i),e(u).then(function(e){a(e,l)}).catch(function(e){t(e,l)})}function r(e){var o=[],n=Object.keys(e),r=Object.values(e);for(let e=0;e<=n.length;e+=1)o.push(encodeURIComponent(n[e])+"="+encodeURIComponent(r[e]));return o.join("&")}function a(e,o){var n=e.data,r=e.status,a=e.headers,t=e.config;"function"==typeof o&&o(n,r,a,t)}function t(e,o){console.log(e);var n=e.data,r=e.status,a=e.headers,t=e.config;console.error("Error "+r+" in HTTP request"),"function"==typeof o&&o(n,r,a,t)}}])}(),function(){angular.module("app").factory("session",["api",function(e){var o={id:-1,name:"",email:"",role:"",verified:!1,token:null,set:n,get:a,logout:t,save:r};return a(),o;function n(n){var a;o.id=n.id||-1,o.name=n.name||"",o.email=n.email||"",o.role=n.role||"",o.verified=n.verified||!1,n.token&&(a=n.token,o.token=a,e.setToken(a),r()),r()}function r(e){var n=e;void 0===n&&(delete(n=JSON.parse(JSON.stringify(o))).set,delete n.get,delete n.logout,delete n.save),localStorage.setItem("session",JSON.stringify(n))}function a(){var e=JSON.parse(localStorage.getItem("session"));null!==e?n(e):(console.warn("There was no session stored. Logout forzed."),t())}function t(){console.warn("Clossing session..."),o.id=-1,o.name="",o.email="",o.role="",o.verified=!1,localStorage.removeItem("session")}}])}(),angular.module("app").service("video",["api",videoService]),function(){angular.module("app").controller("LoginController",["login","session","$state","$stateParams","$translate",function(e,o,n,r,a){var t=this;t.service=e,t.username="",t.password="",t.error="",t.loading=!1,t.submit=function(){""!==t.username&&""!==t.password?(t.loading=!0,t.error=null,console.log("Submiting..."),t.service.login(t.username,t.password,s)):t.error=a.instant("WRONG_LOGIN")},o.id>0&&(console.log("Found a session! Redirecting..."),n.go(r.redirect||"home"));function s(e){t.loading=!1,e?(console.log("Logged in! Redirecting..."),n.go(r.redirect||"home")):(console.log("Bad username or password..."),t.error=a.instant("WRONG_LOGIN"))}}])}(),function(){angular.module("app").factory("login",["api","session",function(e,o){var n={login:function(r,a,t){var s={email:r,password:a};return n.pending=!0,e.post(e.url+"/login",s,function(e,r){n.pending=!1;var a=!1;r>=400?(console.error("Error while logging in"),a=!1):(a=!0,o.set(e)),"function"==typeof t?t(a,e):console.warn("No callback specified for login.")})},pending:!1};return n}])}(),function(){angular.module("app").controller("RegisterController",["register","login","session","$state","$stateParams","$translate",function(e,o,n,r,a,t){var s=this;s.service=e,s.username="",s.email="",s.password="",s.age="",s.terms=!1,s.error=[],s.loading=!1,s.status={register:!0,terms:!1,captcha:!1},s.list1=function(){var e;s.loading=!0,s.error=null,e=function(e){e?s.loading=!1:s.service.validateUsernameAndEmail(s.username,s.email,i)},s.error=[],""===s.username?s.error.push(t.instant("ERROR_USERNAME_EMPTY")):s.username.length<5?s.error.push(t.instant("ERROR_USERNAME_MIN_LENGTH")):s.username.length>30&&s.error.push(t.instant("ERROR_USERNAME_MAX_LENGTH")),""===s.password?s.error.push(t.instant("ERROR_PASSWORD_EMPTY")):s.password.length<5?s.error.push(t.instant("ERROR_PASSWORD_MIN_LENGTH")):s.password.length>30&&s.error.push(t.instant("ERROR_PASSWORD_MAX_LENGTH")),""===s.email?s.error.push(t.instant("ERROR_EMAIL_EMPTY")):s.email.length<5?s.error.push(t.instant("ERROR_EMAIL_MIN_LENGTH")):s.email.length>30?s.error.push(t.instant("ERROR_EMAIL_MAX_LENGTH")):/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/.test(s.email)||s.error.push(t.instant("ERROR_EMAIL_NOT_VALID")),0===s.error.length?e(!1):e(!0)},s.list2=function(){var e;s.loading=!0,e=function(e){s.loading=!1,e||(s.status.terms=!1,s.status.captcha=!0)},s.error=[],""===s.age?s.error.push(t.instant("ERROR_AGE_EMPTY")):(isNaN(parseInt(s.age,10))||parseInt(s.age,10)<=0)&&s.error.push(t.instant("ERROR_AGE_WRONG")),!1===s.terms&&s.error.push(t.instant("ERROR_TERMS_EMPTY")),0===s.error.length?e(!1):e(!0)},s.submit=function(){s.error=[],""!==s.username&&""!==s.password?(s.loading=!0,s.service.register(s.username,s.email,s.password,s.age,l)):s.error.push(t.instant("WRONG_REGISTER"))},n.id>0&&r.go(a.redirect||"home");function i(e){s.loading=!1,e&&(s.status.register=!1,s.status.terms=!0)}function l(e){s.loading=!1,e?(s.loading=!0,o.login(s.username,s.password,function(e){s.loading=!1,e?r.go(a.redirect||"home"):(s.error.push(t.instant("WRONG_LOGIN")),r.go("login"))})):s.error.push(t.instant("WRONG_REGISTER"))}}])}(),function(){angular.module("app").factory("register",["api",function(e){var o={validateUsernameAndEmail:function(o,n,r){e.get(e.url+"/user/exist?name="+o+"&email="+n,function(e,o){var n=!0;o>=400&&(console.error("Error while registering"),n=!1),console.log(e,o),r(n,e)})},register:function(n,r,a,t,s){var i={name:n,email:r,password:a,age:t};o.pending=!0,e.post(e.url+"/user",i,function(e,n){o.pending=!1;var r=!0;n>=400&&(console.error("Error while registering"),r=!1),s(r,e)})},pending:!1};return o}])}(),angular.module("app").controller("VideoDownloadController",["$stateParams","video","videoDownload",VideoDownload]),angular.module("app").service("videoDownload",["api",videoDownloadService]);